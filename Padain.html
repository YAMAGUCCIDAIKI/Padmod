<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Scripts</title>
		<style>
			body {
				background-color: #0097a7;
				font-family: Arial, sans-serif;
				margin: 0;
				padding: 0;
				display: flex;
				justify-content: center;
				align-items: center;
				height: 100vh;
				-webkit-user-select: none; /* SafariやiOS用 */
				-moz-user-select: none; /* Firefox用 */
				-ms-user-select: none; /* IE用 */
				user-select: none;
			}

			.mod-menu {
				background: rgba(255, 255, 255, 0.3);
				padding: 20px;
				border-radius: 10px;
				box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
				width: 300px;
				overflow-y: auto;
				max-height: 100vh;
			}

			.menu-title {
				color: white;
				text-align: center;
				font-size: 27px;
				margin-bottom: 20px;
			}

			.menu-description {
				color: white;
				text-align: center;
				font-size: 18px;
				margin-bottom: 10px;
			}

			.menu-section-title {
				color: white;
				font-size: 21px;
				margin-bottom: 5px;
			}

			.button:not(#stopwatch),
			.prompt-button {
				background-color: transparent;
				border: 2px solid white;
				color: white;
				padding: 10px;
				width: 90%;
				text-align: center;
				border-radius: 5px;
				margin-bottom: 10px;
				cursor: pointer;
				transition: background-color 0.3s;
			}

			.button:hover,
			#stopwatch:hover,
			.prompt-button:hover {
				background-color: rgba(255, 255, 255, 0.5);
			}

			.checkbox-container {
				display: flex;
				align-items: center;
				margin-bottom: 10px;
			}

			.checkbox-label {
				margin-left: 10px;
				color: white;
				cursor: pointer;
			}

			.checkbox {
				appearance: none;
				-webkit-appearance: none;
				background-color: transparent;
				margin: 0;
				font-size: 24px;
				width: 1em;
				height: 1em;
				border: 2px solid white;
				border-radius: 5px;
				display: grid;
				place-content: center;
				cursor: pointer;
			}

			.checkbox:checked {
				background-color: white;
			}

			.checkbox:before {
				content: "✓";
				width: 1.2em;
				height: 1.2em;
				border-radius: 5px;
				transform: scale(0);
				transition: 120ms transform ease-in-out;
				box-shadow: inset 1em 1em var(--form-control-color);
				display: flex;
				align-items: center;
				justify-content: center;
			}

			.checkbox:checked:before {
				transform: scale(1);
			}

			#stopwatch {
				background-color: transparent; /* 初期状態の背景色 */
			}
		</style>
	</head>
	<body>
		<div class="mod-menu">
			<div class="menu-title">パズドラMod<br />Ver-1.0.2</div>
			<div class="menu-description">Created By Tain</div>

			<button id="updateButton" onclick="updatePage()">更新</button>

			<!-- <div class="menu-section-title">--Button--</div> -->
			<div class="menu-section">
				<div class="button" id="KaihukuMezame" onclick="copyText();">
					回復目覚めのAddressコピー
				</div>
				<div class="button" onclick="Seigyo();">吸収貫通</div>
				<div class="button" onclick="cheatMode();">升</div>
			</div>
			<!-- <div class="menu-section-title">--CheckBox--</div> -->
			<div class="menu-section">
				<div class="button" id="stopwatch" onclick="stopwatch();">
					ストップウォッチ
				</div>
				<div class="checkbox-container">
					<input
						type="checkbox"
						id="fastclear"
						class="checkbox"
						onclick="checkAlert(this);"
					/>
					<label
						for="fastclear"
						class="checkbox-label"
						id="checkbox-label"
						>即クリア(入力値)</label
					>
				</div>
				<!-- <div class="checkbox-container">
					<input type="checkbox" id="checkbox2" class="checkbox" onclick="checkAlert(this);">
					<label for="checkbox2" class="checkbox-label">チェックボックス2</label>
				</div> -->
				<!-- <div class="checkbox-container">
					<input type="checkbox" id="checkbox3" class="checkbox">
					<label for="checkbox3" class="checkbox-label" id="checkbox-label">チェックボックス3</label>
				</div> -->
			</div>
			<!-- <div class="menu-section-title">--Prompt--</div> -->
			<div class="menu-section">
				<div class="prompt-button" onclick="showPrompt();">HP入力</div>
			</div>
			<div class="menu-section">
				<div class="prompt-button" onclick="LockHP();">
					HP入力(ダンジョン前)
				</div>
			</div>
		</div>

		<script>
			setButtonImage(
				"https://image.itmedia.co.jp/nl/articles/1408/26/ah_rk03.jpg"
			);
			setWindowDrag(0, 0, 350, 60);
			// 画面の幅と高さを取得
			let screenWidth = window.innerWidth;
			let screenHeight = window.innerHeight;

			// 任意のウィンドウの幅と高さ
			let windowWidth = 200;
			let windowHeight = 350;

			// 画面の中心座標を計算
			let centerX = (screenWidth - windowWidth) / 2;
			let centerY = screenHeight / 2;

			// ウィンドウの位置を変更せず、サイズのみを変更して中心を設定
			setWindowRect(centerX, centerY, windowWidth, windowHeight);

			var UserteamHP;
			let HPAddress;
			let clear;
			let KaihukuMezameTurn;

			function updateAddresses() {
				// HP値を検索
				h5gg.searchNumber(
					UserteamHP,
					"I32",
					"0x00000000",
					"0x200000000"
				);
				let results = h5gg.getResults(20, 0);
				let filteredResults = [];

				// アドレスの末尾が '44' の結果を絞り込む
				for (let i = 0; i < results.length; i++) {
					let address = results[i].address;
					if (address.endsWith("44")) {
						filteredResults.push(results[i]);
					}
				}

				// 絞り込んだ結果からアドレスを取得して更新
				if (filteredResults.length > 0) {
					//ここに登録する数値たち入れるこここここおおおこおここここここここここここここここここここここここここここ
					HPAddress = parseInt(filteredResults[0].address, 16); // 数値型としてアドレスを扱う
					KaihukuMezameTurn = HPAddress - 0x9168; // 回復目覚めターン用アドレス
					SousaTime = KaihukuMezameTurn - 0x98;
					KakuseiMukou = KaihukuMezameTurn + 0x250; //HPAdress - 8f18
					AttackDown = KakuseiMukou + 0x14;
					Seal = AttackDown + 0x34;
					ComboPlus = Seal + 0x38;
					Cloud = ComboPlus + 0x64;
					ZokuseiKyushu = Cloud + 0x14;
					ComboKyushu = ZokuseiKyushu + 0x14;
					DamageKyushu = ComboKyushu + 0x14;
					DropUnable = DamageKyushu + 0x48;
					TurnHPKaihuku = DropUnable + 0x14;
					MaxHP = TurnHPKaihuku + 0x34;
					Roulette = MaxHP + 0x14;
					PlusDropMezame = Roulette + 0x94;
					EnemyLockon = PlusDropMezame + 0x14;
					OchicomNashi = EnemyLockon + 0x14;
					MaxAttack = OchicomNashi + 0x24;
					DamageMukou = MaxAttack + 0x54;
					Masuchange = DamageMukou + 0x14;
					Chokurayami = Masuchange + 0x24;
					ComboDropMezame = Chokurayami + 0x28;
					SkillHooin = ComboDropMezame + 0xc4;
					AssistMukou = SkillHooin + 0x14;
					ComboGensho = AssistMukou + 0x14;
					TogeDropMezame = ComboGensho + 0x14;

					clear = HPAddress - 0x14;
					//敵一体目 = HPAddress - 0x55dc;
					//敵二体目 = HPAddress - 0x4aec;

					// ボタン表示を更新
					document.getElementById("KaihukuMezame").innerText =
						"回復目覚め (0x" + KaihukuMezameTurn.toString(16) + ")";
				} else {
					console.log("No valid results found.");
				}
				h5gg.clearResults();
			}

			function KaihukuMezame() {
				h5gg.setValue(KaihukuMezameTurn, 99, "I32");
			}

			function Seigyo() {
				h5gg.setValue(ZokuseiKyushu, 99, "I32");
				h5gg.setValue(ComboKyushu, 99, "I32");
				h5gg.setValue(DamageKyushu, 99, "I32");
				h5gg.setValue(DamageMukou, 99, "I32");
				h5gg.setValue(Chokurayami, 0, "I32");
			}

			function ZokuseiKyushuMukou() {
				h5gg.setValue(ZokuseiKyushu, 99, "I32");
			}

			function setCheatValues(value) {
				const cheatValues = [
					KaihukuMezameTurn,
					SousaTime,
					KakuseiMukou,
					AttackDown,
					Seal,
					ComboPlus,
					Cloud,
					ZokuseiKyushu,
					ComboKyushu,
					DamageKyushu,
					DropUnable,
					TurnHPKaihuku,
					MaxHP,
					Roulette,
					PlusDropMezame,
					EnemyLockon,
					OchicomNashi,
					MaxAttack,
					DamageMukou,
					Chokurayami,
					ComboDropMezame,
					SkillHooin,
					AssistMukou,
					ComboGensho,
					TogeDropMezame,
				];
				cheatValues.forEach((key) => h5gg.setValue(key, value, "I32"));
			}

			let cheatflag = false;

			function cheatMode() {
				if (!cheatflag) {
					setCheatValues(99); // チートオン
					cheatflag = true;
				} else {
					setCheatValues(0); // チートオフ
					cheatflag = false;
				}
			}

			function checkAlert(checkbox) {
				if (checkbox.checked) {
					//   alert('Checked!');
					intervalID = setInterval(change_stage, 500);
				} else {
					clearInterval(intervalID);
				}
			}

			HPhyouji = setInterval(() => {
				if (!isNaN(HPAddress)) {
					let value = h5gg.getValue(HPAddress, "I32");
					const label = document.getElementById("checkbox-label");

					// HTML 要素が存在する場合にのみ更新
					if (label) {
						label.innerText = "即クリア (" + value + ")";
					}
				} else {
					clearInterval(HPhyouji);
				}
			}, 1000);

			let inputHPFlag = false;

			function showPrompt() {
				var userInput = prompt("ここに入力してください:");
				if (userInput != null) {
					inputHPFlag = true;
					// 入力された値を使用する処理をここに書く
					UserteamHP = userInput;
					// document.getElementById("checkbox-label").innerText =
					// 	"即クリア (" + UserteamHP + ")";
					// alert("入力された値: " + userInput);
					// 入力値に基づいてアドレスを検索し更新
					updateAddresses();
					if (isNaN(HPAddress)) {
						inputHPFlag = false;
					}
				}
			}

			let HPLock;

			function LockHP() {
				var userInput = prompt("ここに入力してください:");
				if (userInput != null) {
					HPLock = setInterval(() => {
						if (!inputHPFlag) {
							// 入力された値を使用する処理をここに書く
							UserteamHP = userInput;
							// 入力値に基づいてアドレスを検索し更新
							updateAddresses();
						}
					}, 1000);
				}
			}

			function change_stage() {
				if (HPAddress) {
					h5gg.setValue(clear, 0, "I32");
					h5gg.setValue(clear + 4, 0, "I32");
				} else {
					console.log("HPアドレスが設定されていません。");
				}
			}

			let stopwatchflag = false;
			let Timer;
			let second = 0;

			function stopwatch() {
				const stopwatchButton = document.getElementById("stopwatch");
				if (!stopwatchflag) {
					second = 0;
					Timer = setInterval(startcount, 5000);
					stopwatchflag = true;
					// ストップウォッチがオンのとき背景色を変更
					stopwatchButton.style.backgroundColor = "#FF6347"; // 例えば、トマト色に変更
				} else {
					clearInterval(Timer);
					stopwatchflag = false;
					document.getElementById("stopwatch").innerText =
						"ストップウォッチ";
					// ストップウォッチがオフのとき背景色を元に戻す
					stopwatchButton.style.backgroundColor = "transparent"; // 元の背景色に戻す
				}
			}

			function startcount() {
				second++;
				second++;
				second++;
				second++;
				second++;
				document.getElementById("stopwatch").innerText = second;
			}

			function copyText() {
				// 16進数形式に変換
				const hexValue =
					"0x" + KaihukuMezameTurn.toString(16).toUpperCase(); // 0xプレフィックスを追加

				// 一時的にテキストエリアを作成して16進数形式のアドレスをコピー
				const textarea = document.createElement("textarea");
				textarea.value = hexValue; // 16進数形式に変換したアドレスを設定
				document.body.appendChild(textarea); // テキストエリアを追加

				// テキストを選択してコピー
				textarea.select();
				textarea.setSelectionRange(0, 99999); // モバイル対応のため範囲を指定

				// コピーコマンドを実行
				document.execCommand("copy");

				// コピー後にテキストエリアを削除
				document.body.removeChild(textarea);

				alert("コピーしました: " + hexValue); // コピーした16進数形式のアドレスを表示
			}

			function updatePage() {
				const updatedFileURL =
					"https://yamaguccidaiki.github.io/Padmod/Padain.html"; // 最新HTMLファイルのURL

				fetch(updatedFileURL, { cache: "no-cache" }) // キャッシュを無効化
					.then((response) => {
						if (!response.ok) {
							throw new Error(
								"Failed to fetch the updated file."
							);
						}
						return response.text();
					})
					.then((newHtml) => {
						// 新しいHTMLを現在のページに反映
						document.open();
						document.write(newHtml);
						document.close();

						alert("更新しました。");
					})
					.catch((error) => {
						console.error("更新に失敗しました:", error);
						alert("更新に失敗しました。もう一度試してください。");
					});
			}

			//他に処理を追加する
		</script>
	</body>
</html>

<!-- 処理を変えたり、追加したりしてもOK。ボタンや、チェックボックスとかも変えてOK。-->
<!-- Created By Torriot Projects -->
